<!DOCTYPE html>
<html lang="ko"
      class="no-js"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns="http://www.w3.org/1999/html">

<body>

    <main layout:fragment="main">
        <style>
            #payDate {
                padding: 0 2.5rem !important;
            }
        </style>
        <div class="lg:space-x-12">
            <div class="lg:w-full card">

                <div class="p-10 pt-4">

                    <div class="md:py-8 py-3">
                        <div class="flex justify-between align-items-center">
                            <h2 class="text-xl font-bold">
                                <span class="mr-2">üí∞</span>Í≤ΩÎπÑ ÎÇ¥Ïó≠ Í¥ÄÎ¶¨
                            </h2>
                            <div class="relative w-1/3">
                                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                                    <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                                <div>
                                    <form method="get" th:action id="searchForm">
                                        <input type="text" name="payDate" id="payDate" readonly required class="bg-gray-50 border border-gray-300 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5" placeholder="ÎÇ†ÏßúÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.">
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr class="mb-8">

                    <div class="grid grid-cols-2 gap-4 mb-8">
                        <button onclick="window.location.href='/manager/expenses/FUEL'" class="w-full bg-blue-600 py-1 text-white rounded-lg">Ï£ºÏú†ÎπÑ</button>
                        <button onclick="window.location.href='/manager/expenses/FOOD'" class="w-full bg-blue-600 py-1 text-white rounded-lg">ÏãùÎπÑ</button>
                    </div>

                    <hr>

                    <div class="md:py-8 py-3">

                        <div class="relative overflow-x-auto shadow-md" id="select-div">

                            <table class="w-full text-sm text-left text-gray-500 live-search-table">
                                <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-2 py-3 uk-text-center whitespace-nowrap">
                                        Ïã†Ï≤≠ Î≤àÌò∏
                                    </th>
                                    <th scope="col" class="px-2 py-3 uk-text-center whitespace-nowrap">
                                        ÏÇ¨Ïõê Ï†ïÎ≥¥
                                    </th>
                                    <th scope="col" class="px-2 py-3 uk-text-center whitespace-nowrap">
                                        Íµ¨Î∂Ñ
                                    </th>
                                    <th scope="col" class="px-2 py-3 uk-text-center whitespace-nowrap">
                                        ÎπÑÏö©
                                    </th>
                                    <th scope="col" class="px-2 py-3 uk-text-center whitespace-nowrap">
                                        Ïú†Ï¢Ö
                                    </th>
                                    <th scope="col" class="px-2 py-3 uk-text-center whitespace-nowrap">
                                        Í∑ºÎ¨¥ÏßÄ
                                    </th>
                                    <th scope="col" class="px-2 py-3 uk-text-center w-50 whitespace-nowrap">
                                        ÎÇ†Ïßú
                                    </th>
                                    <th scope="col" class="px-2 py-3 uk-text-center w-50 whitespace-nowrap">
                                        ÏòÅÏàòÏ¶ù
                                    </th>
                                    <th scope="col" class="px-2 py-3 uk-text-center w-50 whitespace-nowrap">
                                        ÌôïÏù∏ Ïó¨Î∂Ä
                                    </th>
                                </tr>
                                </thead>
                                <tbody class="uk-text-center">
                                <tr class="bg-white border-b" th:each="expenses, loop : ${expensesList}">
                                    <th scope="row" class="px-2 py-4 font-medium whitespace-nowrap">
                                        <h3 th:text="${expenses.getId()}">ÏïÑÏù¥Îîî</h3>
                                    </th>
                                    <td class="px-2 py-4 whitespace-nowrap" th:text="${expenses.getMember().getName()}">Ïù¥Î¶Ñ</td>
                                    <td class="px-2 py-4 whitespace-nowrap" th:text="${expenses.getExpensesStatus().getViewName()}">Íµ¨Î∂Ñ</td>
                                    <td class="px-2 py-4 whitespace-nowrap" th:text="${#numbers.formatInteger(expenses.getCost(), 3, 'COMMA')}">ÎπÑÏö©</td>
                                    <td class="px-2 py-4 whitespace-nowrap">
                                        <a th:if="${expenses.getExpensesStatus().equals(T(com.ezkorea.hybrid_app.domain.expenses.ExpensesStatus).FUEL)}" th:text="${expenses.getFuelStatus().getViewName()}"></a>
                                        <a th:if="${!expenses.getExpensesStatus().equals(T(com.ezkorea.hybrid_app.domain.expenses.ExpensesStatus).FUEL)}">-</a>
                                    </td>
                                    <td class="px-2 py-4 whitespace-nowrap" th:text="${expenses.getGasStation() != null ? expenses.getGasStation().getStationName() : '-'}">Í∑ºÎ¨¥ÏßÄ</td>
                                    <td class="px-2 py-4 whitespace-nowrap" th:text="${expenses.getPayDate()}"></td>
                                    <td class="px-2 py-4 whitespace-nowrap">
                                        <button class="button gray" type="button" th:uk-toggle="|target: #modal${expenses.getId()}|">ÏòÅÏàòÏ¶ù ÌôïÏù∏</button>

                                        <!-- This is the modal with the default close button -->
                                        <div th:id="|modal${expenses.getId()}|" uk-modal>
                                            <div class="uk-modal-dialog uk-modal-body rounded-md shadow-2xl">
                                                <button class="uk-modal-close-default bg-gray-300 p-2 rounded-full m-3" type="button" uk-close></button>
                                                <h2 class="mb-2 uk-modal-title">ÏòÅÏàòÏ¶ù</h2>
                                                <img th:src="${expenses.getS3Image().getFilePath()}">

                                                <hr class="my-4">

                                                <div class="flex justify-between align-items-center">
                                                    <div>
                                                        <select th:id="|checkStatus${expenses.getId()}|" name="checkStatus">
                                                            <option th:value="${check}"
                                                                    th:selected="${expenses.getCheckStatus().equals(check)}"
                                                                    th:text="${check.viewName}"
                                                                    th:each="check : ${T(com.ezkorea.hybrid_app.domain.expenses.CheckStatus).values()}"></option>
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <button class="bg-blue-600 rounded-lg px-8 text-white py-1 uk-modal-close" th:onclick="|checkTask(${expenses.getId()})|">Ï†ÄÏû•</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-2 py-4 whitespace-nowrap" >
                                        <div th:id="|expenses${expenses.getId()}|">
                                            <a th:text="${expenses.getCheckStatus().viewName}"></a>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
                <div class="m-4 px-10 pb-10 mx-auto">
                    <nav th:if="${!expensesList.isEmpty()}">
                        <div class="flex justify-center">
                            <ul class="inline-flex items-center -space-x-px">
                                <li>
                                    <a th:href="@{|?page=${expensesList.number - 1}|}" th:classappend="${!expensesList.hasPrevious} ? 'hidden'"
                                       class="block px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white" >
                                        <span class="sr-only">Previous</span>
                                        <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                                    </a>
                                </li>
                                <li th:each="page : ${#numbers.sequence(0, expensesList.totalPages - 1)}"
                                    th:if="${page >= expensesList.number - 2 and page <= expensesList.number + 2}">
                                    <a th:text="${page + 1}" th:href="@{|?page=${page}|}"
                                       th:classappend="${page == expensesList.number} ? 'bg-blue-500 z-10 text-white'"
                                       th:aria-current="${page == expensesList.number} ? 'page' : ''"
                                       class="px-3 py-2 leading-tight border border-gray-300 hover:bg-gray-100 hover:text-gray-700">1</a>
                                </li>
                                <li th:classappend="${!expensesList.hasNext} ? 'hidden'">
                                    <a th:href="@{|?page=${expensesList.number+1}|}" class="block px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                                        <span class="sr-only">Next</span>
                                        <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
        <script th:inline="javascript">

            $(document).ready(function() {

                const urlParams = new URLSearchParams(window.location.search);
                const searchDate = urlParams.get('payDate');
                if (searchDate !== '') {
                    $('#payDate').val(searchDate);
                }


                $('#payDate').datepicker({
                    autoclose: true,
                    dateFormat: 'yy-mm-dd'
                }).on('change', function() {
                    let selectedDate = $(this).val();
                    console.log(selectedDate);
                    $('#searchForm').submit();
                });
            });

            function checkTask(id) {
                let status = $(`#checkStatus${id} option:selected`).val();
                let data = {
                    checkStatus : status,
                    id: id
                }
                fnOnlyCrudJsonAjax(data, '/expenses', 'PUT', refreshDiv);
            }

            function removeTask(id) {

                Swal.fire({
                    title: 'ÎÇ¥Ïó≠ ÏÇ≠Ï†ú',
                    text: id + 'Î≤à ÎÇ¥Ïó≠ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
                    showDenyButton: true,
                    showCancelButton: true,
                    confirmButtonText: 'ÏÇ≠Ï†úÌïòÍ∏∞',
                    denyButtonText: 'Ï∑®ÏÜå',
                }).then((result) => {
                    if (result.isConfirmed) {
                        let data = {
                            id: id
                        }
                        fnResponseCrudJsonAjax(data, '/expenses', 'DELETE', refreshPage);
                        setTimeLoadingSpinner(1100, "ÎÇ¥Ïó≠ÏùÑ ÏÇ≠Ï†úÌïòÍ≥† ÏûàÏäµÎãàÎã§.");
                        setTimeout(function () {
                            let currentURI = window.location.href;
                            console.log(currentURI);
                            let status = currentURI.split('/').pop();
                            $(location).attr("href", "/manager/expenses/".concat(status));
                        }, 1100);
                    } else if (result.isDenied) {
                        Swal.fire('Î≥ÄÍ≤ΩÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.')
                    }
                })

            }

            jQuery(document).ready(function($){

                $('.live-search-table tbody tr').each(function(){
                    $(this).attr('data-search-term', $(this).contents().find( "h3" ).text().toLowerCase());
                });

                $('.table-live-search-box').on('keyup', function(){

                    let searchTerm = $(this).val().toLowerCase();

                    $('.live-search-table tbody tr').each(function(){
                        if ($(this).filter('[data-search-term *= ' + searchTerm + ']').length > 0 || searchTerm.length < 1) {
                            $(this).show();
                        } else {
                            $(this).hide();
                        }
                    });
                });

            });

            function refreshPage(data) {
                location.reload();
            }

            function refreshDiv(data, xhr) {
                $(`#expenses${xhr.id}`).load(location.href+` #expenses${xhr.id}`);
            }
        </script>
    </main>

</body>

</html>