<!DOCTYPE html>
<html lang="ko"
      class="no-js"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout-login}"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" xmlns="http://www.w3.org/1999/html">

    <body>
        <main layout:fragment="login">
            <!-- Content-->
            <div class="lg:p-12 max-w-xl lg:my-0 my-12 mx-auto p-6 space-y-">
                <form th:action method="post" id="signUpForm" class="lg:p-10 p-6 space-y-3 relative bg-white shadow-xl rounded-md" autocomplete="off">
                    <h1 class="lg:text-2xl text-xl font-semibold mb-6"> Register </h1>

                    <div class="grid lg:grid-cols-1 gap-3">
                        <div>
                            <label class="mb-0"> 아이디 </label>
                            <input type="text" name="username" id="username" placeholder="아이디를 입력해주세요." class="bg-gray-100 h-12 mt-2 px-3 rounded-md w-full" required>
                            <button type="button" id="usernameChk" class="bg-blue-600 font-semibold p-2 mt-5 rounded-md text-center text-white w-full">
                                중복 확인</button>
                        </div>

                        <div>
                            <label class="mb-0"> 비밀번호 </label>
                            <input type="password" id="password" placeholder="비밀번호를 입력해주세요." class="bg-gray-100 h-12 mt-2 px-3 rounded-md w-full" required>
                        </div>
                        <div>
                            <label class="mb-0"> 비밀번호 확인 </label>
                            <input type="password" id="passwordChk" name="password" placeholder="비밀번호를 다시 입력해주세요." class="bg-gray-100 h-12 mt-2 px-3 rounded-md w-full" required>
                        </div>

                        <div class="grid lg:grid-cols-1 gap-3">
                            <div>
                                <label class="mb-0"> 이름 </label>
                                <input type="text" name="name" placeholder="이름을 입력해주세요." class="bg-gray-100 h-12 mt-2 px-3 rounded-md w-full" required>
                            </div>
                        </div>

                        <div class="grid lg:grid-cols-1 gap-3">
                            <div>
                                <label class="mb-0"> 이메일 </label>
                                <input type="email" name="email" placeholder="이메일을 입력해주세요." class="bg-gray-100 h-12 mt-2 px-3 rounded-md w-full" required>
                                <small class="text-gray-500">➡️ 회원님이 사용 중인 이메일을 입력해주세요.</small><br>
                            </div>
                        </div>

                        <div class="hidden">
                            <input type="hidden" name="status" value="AWAIT" class="bg-gray-100 h-12 mt-2 px-3 rounded-md w-full" readonly required>
                            <input type="hidden" name="role" value="ROLE_EMPLOYEE" class="bg-gray-100 h-12 mt-2 px-3 rounded-md w-full" readonly required>
                        </div>

                        <div>
                            <label class="mb-0"> 핸드폰 번호 </label>
                            <div class="grid grid-cols-3 gap-3">
                                <div>
                                    <input type="text" id="phone1" name="phone1" placeholder="핸드폰 번호를 입력해주세요." class="bg-gray-100 h-12 mt-2 px-3 rounded-md w-full" maxlength="3" value="010" readonly>
                                </div>
                                <div>
                                    <input type="text" id="phone2" name="phone2" placeholder="앞번호" class="bg-gray-100 h-12 mt-2 px-3 rounded-md w-full" maxlength="4" required>
                                </div>
                                <div>
                                    <input type="text" id="phone3" name="phone3" placeholder="뒷번호" class="bg-gray-100 h-12 mt-2 px-3 rounded-md w-full" maxlength="4" required>
                                </div>
                            </div>
                            <input type="hidden" id="phone" name="phone" placeholder="뒷번호" class="bg-gray-100 h-12 mt-2 px-3 rounded-md w-full">
                        </div>
                        <div class="grid lg:grid-cols-1 gap-3">
                            <div>
                                <label class="mb-0"> 성별 </label>
                                <select name="sex" class="selectpicker mt-2">
                                    <option value="MALE">남자</option>
                                    <option value="FEMALE">여자</option>
                                </select>

                            </div>
                        </div>

                        <div class="checkbox">
                            <input type="checkbox" id="chekcbox1" checked="">
                            <label for="chekcbox1"><span class="checkbox-icon"></span> 개인 정보 수집 약관에 동의합니다. </a>
                            </label>
                        </div>

                        <div>
                            <button type="submit" id="submit" class="bg-blue-600 font-semibold p-2 mt-5 rounded-md text-center text-white w-full">
                                가입하기</button>
                        </div>
                    </div>

                </form>

            </div>
            <script>
                let existUsername = true;
                $('#signUpForm').submit(function() {

                    if (existUsername === true) {
                        Swal.fire({
                            icon: 'error',
                            text: '아이디 중복 확인을 해주세요.',
                        });
                        return false;
                    }

                    if ($('#password').val() !== $('#passwordChk').val()) {
                        Swal.fire({
                            icon: 'error',
                            text: '비밀번호가 일치하지 않습니다.',
                        });
                        return false;
                    }

                    let phone = $('#phone1').val() + $('#phone2').val() + $('#phone3').val();
                    $('#phone').attr('value', phone);

                });
                $("#usernameChk").on("click", function (){
                    // 아이디 중복 확인 ajax 처리 -> 성공 로직
                    let chkUsername = $('#username').val();
                    let url = "/signup/" + chkUsername;

                    fnMethodFindJsonAjax("get", chkUsername, url, existsByData);

                });

                function existsByData(data) {
                    if (data === true) {
                        existUsername = true;
                        $('#username').attr('readonly', false);
                        Swal.fire({
                            icon: 'error',
                            text: '이미 사용 중인 아이디입니다.',
                        });
                    }
                    if (data === false) {
                        existUsername = false;
                        $('#username').attr('readonly', true);
                        Swal.fire({
                            icon: 'success',
                            text: '사용할 수 있는 아이디입니다.',
                        });
                    }
                }
            </script>
        </main>
    </body>

</html>